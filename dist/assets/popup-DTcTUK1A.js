import{i as g,c as y}from"./serializer-DZ1wSGbK.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function a(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=a(n);fetch(n.href,o)}})();document.addEventListener("DOMContentLoaded",async()=>{await d(),v(),b()});async function d(){try{const e=await chrome.runtime.sendMessage({type:"STATE_REQUEST",payload:{},timestamp:Date.now(),source:"popup"});if(e!=null&&e.state&&h(e.state),e!=null&&e.activeTabs){const t=e.activeTabs,a=Object.values(t);if(a.length>0){const r=a[a.length-1];w(r.platform),f("Capturing")}}}catch(e){console.warn("[CLO Popup] Failed to get state:",e),f("Disconnected");const t=document.getElementById("popup-status-dot");t&&t.classList.remove("active")}}function h(e){const t=document.getElementById("popup-task-title"),a=document.getElementById("popup-task-objective");t&&(t.textContent=e.meta.title||"Untitled Task"),a&&(a.textContent=e.meta.objective||"No objective set yet."),s("popup-turns",e.meta.totalTurns),s("popup-artifacts",e.artifacts.length),s("popup-constraints",e.constraints.length),s("popup-decisions",e.decisions.length),s("popup-models",e.meta.models.length),s("popup-platforms",e.meta.platforms.length),E(e)}function E(e){const t=document.getElementById("popup-provenance-list");if(!t)return;if(e.provenance.length===0){t.innerHTML='<div class="provenance-empty">No cross-model activity yet</div>';return}const a={chatgpt:"#10a37f",claude:"#d97757",gemini:"#4285f4",grok:"#e8e8e8",perplexity:"#20b8cd",deepseek:"#4d6bfe",kimi:"#6c5ce7",manus:"#ff6b35",copilot:"#7b68ee",you:"#7c3aed",poe:"#5a67d8",huggingchat:"#ffd21e",qwen:"#615aef",mistral:"#ff7000",cohere:"#39594d",unknown:"#888"};t.innerHTML=e.provenance.map(r=>`
    <div class="provenance-entry">
      <span class="provenance-dot" style="background: ${a[r.platform]||"#888"}"></span>
      <span class="provenance-model">${r.model}</span>
      <span class="provenance-turns">${r.turnIds.length} turns</span>
    </div>
  `).join("")}function v(){var e,t,a,r;(e=document.getElementById("popup-inject-btn"))==null||e.addEventListener("click",async()=>{const[n]=await chrome.tabs.query({active:!0,currentWindow:!0});n!=null&&n.id&&await chrome.runtime.sendMessage({type:"INJECT_STATE",payload:{tabId:n.id},timestamp:Date.now(),source:"popup"})}),(t=document.getElementById("popup-export-btn"))==null||t.addEventListener("click",async()=>{const n=await chrome.runtime.sendMessage({type:"EXPORT_STATE",payload:{},timestamp:Date.now(),source:"popup"});if(n!=null&&n.state){const o=JSON.stringify(n.state,null,2),i=new Blob([o],{type:"application/json"}),l=URL.createObjectURL(i),c=document.createElement("a");c.href=l,c.download=`clo-state-${Date.now()}.json`,c.click(),URL.revokeObjectURL(l)}}),(a=document.getElementById("popup-import-btn"))==null||a.addEventListener("click",()=>{const n=document.createElement("input");n.type="file",n.accept=".json",n.onchange=async o=>{var l;const i=(l=o.target.files)==null?void 0:l[0];if(i)try{const c=await i.text(),u=g(c),p=await chrome.runtime.sendMessage({type:"IMPORT_STATE",payload:{state:u},timestamp:Date.now(),source:"popup"});if(p!=null&&p.success)await d(),console.log("[CLO Popup] State imported successfully");else{const m=(p==null?void 0:p.error)||"Import failed for unknown reason";console.error("[CLO Popup] Import failed:",m),alert(`Failed to import state: ${m}`)}}catch(c){const u=c instanceof Error?c.message:String(c);console.error("[CLO Popup] Import error:",u),alert(`Import error: ${u}`)}},n.click()}),(r=document.getElementById("popup-new-btn"))==null||r.addEventListener("click",async()=>{const n=prompt("Task title:","New Task");if(n){const o=y(n);await chrome.runtime.sendMessage({type:"IMPORT_STATE",payload:{state:o},timestamp:Date.now(),source:"popup"}),await d()}})}function b(){chrome.runtime.onMessage.addListener(e=>{if(e.type==="HUD_UPDATE"&&e.source==="background"){const t=e.payload;s("popup-turns",t.totalTurns),s("popup-artifacts",t.artifacts),s("popup-constraints",t.constraints),s("popup-decisions",t.decisions),s("popup-models",t.models.length),s("popup-platforms",t.platforms.length)}})}function s(e,t){const a=document.getElementById(e);a&&(a.textContent=String(t))}function w(e){const t=document.getElementById("popup-platform-badge");t&&(t.textContent=e.toUpperCase(),t.className=`platform-badge ${e}`)}function f(e){const t=document.getElementById("popup-status-text");t&&(t.textContent=e)}

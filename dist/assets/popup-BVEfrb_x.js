import{i as m,c as f}from"./serializer-DRlg360a.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))c(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&c(r)}).observe(document,{childList:!0,subtree:!0});function a(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function c(n){if(n.ep)return;n.ep=!0;const o=a(n);fetch(n.href,o)}})();document.addEventListener("DOMContentLoaded",async()=>{await l(),v(),E()});async function l(){try{const t=await chrome.runtime.sendMessage({type:"STATE_REQUEST",payload:{},timestamp:Date.now(),source:"popup"});if(t!=null&&t.state&&y(t.state),t!=null&&t.activeTabs){const e=t.activeTabs,a=Object.values(e);if(a.length>0){const c=a[a.length-1];h(c.platform),d("Capturing")}}}catch(t){console.warn("[CLO Popup] Failed to get state:",t),d("Disconnected");const e=document.getElementById("popup-status-dot");e&&e.classList.remove("active")}}function y(t){const e=document.getElementById("popup-task-title"),a=document.getElementById("popup-task-objective");e&&(e.textContent=t.meta.title||"Untitled Task"),a&&(a.textContent=t.meta.objective||"No objective set yet."),s("popup-turns",t.meta.totalTurns),s("popup-artifacts",t.artifacts.length),s("popup-constraints",t.constraints.length),s("popup-decisions",t.decisions.length),s("popup-models",t.meta.models.length),s("popup-platforms",t.meta.platforms.length),g(t)}function g(t){const e=document.getElementById("popup-provenance-list");if(!e)return;if(t.provenance.length===0){e.innerHTML='<div class="provenance-empty">No cross-model activity yet</div>';return}const a={chatgpt:"#10a37f",claude:"#d97757",gemini:"#4285f4",grok:"#e8e8e8",unknown:"#888"};e.innerHTML=t.provenance.map(c=>`
    <div class="provenance-entry">
      <span class="provenance-dot" style="background: ${a[c.platform]||"#888"}"></span>
      <span class="provenance-model">${c.model}</span>
      <span class="provenance-turns">${c.turnIds.length} turns</span>
    </div>
  `).join("")}function v(){var t,e,a,c;(t=document.getElementById("popup-inject-btn"))==null||t.addEventListener("click",async()=>{const[n]=await chrome.tabs.query({active:!0,currentWindow:!0});n!=null&&n.id&&await chrome.runtime.sendMessage({type:"INJECT_STATE",payload:{tabId:n.id},timestamp:Date.now(),source:"popup"})}),(e=document.getElementById("popup-export-btn"))==null||e.addEventListener("click",async()=>{const n=await chrome.runtime.sendMessage({type:"EXPORT_STATE",payload:{},timestamp:Date.now(),source:"popup"});if(n!=null&&n.state){const o=JSON.stringify(n.state,null,2),r=new Blob([o],{type:"application/json"}),p=URL.createObjectURL(r),i=document.createElement("a");i.href=p,i.download=`clo-state-${Date.now()}.json`,i.click(),URL.revokeObjectURL(p)}}),(a=document.getElementById("popup-import-btn"))==null||a.addEventListener("click",()=>{const n=document.createElement("input");n.type="file",n.accept=".json",n.onchange=async o=>{var i;const r=(i=o.target.files)==null?void 0:i[0];if(!r)return;const p=await r.text();try{const u=m(p);await chrome.runtime.sendMessage({type:"IMPORT_STATE",payload:{state:u},timestamp:Date.now(),source:"popup"}),await l()}catch(u){console.error("[CLO Popup] Import failed:",u)}},n.click()}),(c=document.getElementById("popup-new-btn"))==null||c.addEventListener("click",async()=>{const n=prompt("Task title:","New Task");if(n){const o=f(n);await chrome.runtime.sendMessage({type:"IMPORT_STATE",payload:{state:o},timestamp:Date.now(),source:"popup"}),await l()}})}function E(){chrome.runtime.onMessage.addListener(t=>{if(t.type==="HUD_UPDATE"&&t.source==="background"){const e=t.payload;s("popup-turns",e.totalTurns),s("popup-artifacts",e.artifacts),s("popup-constraints",e.constraints),s("popup-decisions",e.decisions),s("popup-models",e.models.length),s("popup-platforms",e.platforms.length)}})}function s(t,e){const a=document.getElementById(t);a&&(a.textContent=String(e))}function h(t){const e=document.getElementById("popup-platform-badge");e&&(e.textContent=t.toUpperCase(),e.className=`platform-badge ${t}`)}function d(t){const e=document.getElementById("popup-status-text");e&&(e.textContent=t)}
